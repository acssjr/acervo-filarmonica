{"version":3,"sources":["../../../../../frontend-next/src/utils/instrumentParser.ts","../../../../../frontend-next/src/utils/metadataParser.ts"],"sourcesContent":["// ===== INSTRUMENT PARSER =====\r\n// Funcoes para normalizacao e reconhecimento de nomes de instrumentos\r\n// Extraido de UploadPastaModal.jsx para reutilizacao\r\n\r\n// Mapeamento de algarismos romanos para arabicos\r\nconst romanosParaArabicos: Record<string, number> = {\r\n  'i': 1, 'ii': 2, 'iii': 3, 'iv': 4, 'v': 5,\r\n  'vi': 6, 'vii': 7, 'viii': 8, 'ix': 9, 'x': 10\r\n};\r\n\r\n// Converte romano ou arabico para numero\r\nconst converterParaNumero = (valor: string): number | null => {\r\n  const valorLower = valor.toLowerCase();\r\n  if (romanosParaArabicos[valorLower]) {\r\n    return romanosParaArabicos[valorLower];\r\n  }\r\n  const num = parseInt(valor, 10);\r\n  return isNaN(num) ? null : num;\r\n};\r\n\r\ninterface NumeroPrefixoResult {\r\n  numero: number | null;\r\n  resto: string;\r\n  combinado: boolean;\r\n  numerosCombinados: string | null;\r\n}\r\n\r\n// Detecta numero romano, arabico ou ordinal no inicio do texto\r\nconst extrairNumeroPrefixo = (texto: string): NumeroPrefixoResult => {\r\n  // Padrao para \"I e II\", \"1 e 2\" no inicio (partes combinadas)\r\n  const matchCombinado = texto.match(/^(i+|iv|v|vi+|ix|x|\\d+)\\s*e\\s*(i+|iv|v|vi+|ix|x|\\d+)\\s*/i);\r\n  if (matchCombinado) {\r\n    const num1 = converterParaNumero(matchCombinado[1]);\r\n    const num2 = converterParaNumero(matchCombinado[2]);\r\n    const numerosCombinados = (num1 && num2) ? `${num1} e ${num2}` : null;\r\n    return { numero: null, resto: texto.slice(matchCombinado[0].length), combinado: true, numerosCombinados };\r\n  }\r\n\r\n  // Padrao para numero ordinal no inicio (1o, 2o, 1deg, 2deg, 1a, 2a)\r\n  const matchOrdinal = texto.match(/^(\\d+)[ºª°]\\s*/i);\r\n  if (matchOrdinal) {\r\n    const num = parseInt(matchOrdinal[1], 10);\r\n    if (num >= 1 && num <= 10) {\r\n      return { numero: num, resto: texto.slice(matchOrdinal[0].length), combinado: false, numerosCombinados: null };\r\n    }\r\n  }\r\n\r\n  // Padrao para numero romano sozinho no inicio (I, II, III, IV, etc.)\r\n  const matchRomano = texto.match(/^(i{1,3}|iv|v|vi{0,3}|ix|x)\\s+/i);\r\n  if (matchRomano) {\r\n    const romano = matchRomano[1].toLowerCase();\r\n    const num = romanosParaArabicos[romano];\r\n    if (num) {\r\n      return { numero: num, resto: texto.slice(matchRomano[0].length), combinado: false, numerosCombinados: null };\r\n    }\r\n  }\r\n\r\n  // Padrao para numero arabico sozinho no inicio (1, 2, 3, etc.)\r\n  const matchArabico = texto.match(/^(\\d+)\\s+/);\r\n  if (matchArabico) {\r\n    const num = parseInt(matchArabico[1], 10);\r\n    if (num >= 1 && num <= 10) {\r\n      return { numero: num, resto: texto.slice(matchArabico[0].length), combinado: false, numerosCombinados: null };\r\n    }\r\n  }\r\n\r\n  return { numero: null, resto: texto, combinado: false, numerosCombinados: null };\r\n};\r\n\r\n// Mapeamento completo: nome normalizado -> nome correto/padrao\r\nexport const nomesPadrao: Record<string, string> = {\r\n  // Grade / Regente\r\n  'grade': 'Grade',\r\n  'score': 'Grade',\r\n  'conductor': 'Grade',\r\n  'full score': 'Grade',\r\n  'partitura': 'Grade',\r\n  'maestro': 'Grade',\r\n  'regente': 'Grade',\r\n\r\n  // Flautas (incluindo combinacoes I e II)\r\n  'flautim': 'Flautim',\r\n  'piccolo': 'Flautim',\r\n  'flauta': 'Flauta',\r\n  'flute': 'Flauta',\r\n  'flauta 1': 'Flauta 1',\r\n  'flauta 2': 'Flauta 2',\r\n  'flauta i': 'Flauta 1',\r\n  'flauta ii': 'Flauta 2',\r\n  'flauta 1 e 2': 'Flauta',\r\n  'flauta i e ii': 'Flauta',\r\n  'flautas': 'Flauta',\r\n  'flautas 1 e 2': 'Flauta',\r\n  'flautas i e ii': 'Flauta',\r\n  'flute 1': 'Flauta 1',\r\n  'flute 2': 'Flauta 2',\r\n  'flutes': 'Flauta',\r\n\r\n  // Oboe\r\n  'oboe': 'Oboe',\r\n  'oboes': 'Oboe',\r\n  'oboe 1': 'Oboe 1',\r\n  'oboe 2': 'Oboe 2',\r\n  'oboe i': 'Oboe 1',\r\n  'oboe ii': 'Oboe 2',\r\n  'oboe 1 e 2': 'Oboe',\r\n  'oboe i e ii': 'Oboe',\r\n  'oboes 1 e 2': 'Oboe',\r\n  'oboes i e ii': 'Oboe',\r\n\r\n  // Fagote\r\n  'fagote': 'Fagote',\r\n  'fagotes': 'Fagote',\r\n  'fagote 1': 'Fagote 1',\r\n  'fagote 2': 'Fagote 2',\r\n  'fagote i': 'Fagote 1',\r\n  'fagote ii': 'Fagote 2',\r\n  'fagote 1 e 2': 'Fagote',\r\n  'fagote i e ii': 'Fagote',\r\n  'fagotes 1 e 2': 'Fagote',\r\n  'fagotes i e ii': 'Fagote',\r\n  'bassoon': 'Fagote',\r\n  'bassoons': 'Fagote',\r\n\r\n  // Requinta\r\n  'requinta': 'Requinta',\r\n  'requinta eb': 'Requinta',\r\n  'eb clarinet': 'Requinta',\r\n\r\n  // Clarinete Baixo\r\n  'clarinete baixo': 'Clarinete Baixo',\r\n  'clarineta baixo': 'Clarinete Baixo',\r\n  'clarinet baixo': 'Clarinete Baixo',\r\n  'bass clarinet': 'Clarinete Baixo',\r\n  'clarinet bass': 'Clarinete Baixo',\r\n  'clarone': 'Clarinete Baixo',\r\n\r\n  // Clarinetes\r\n  'clarinete bb': 'Clarinete Bb',\r\n  'clarinete bb 1': 'Clarinete Bb 1',\r\n  'clarinete bb 2': 'Clarinete Bb 2',\r\n  'clarinete bb 3': 'Clarinete Bb 3',\r\n  'clarinete': 'Clarinete Bb',\r\n  'clarinete 1': 'Clarinete Bb 1',\r\n  'clarinete 2': 'Clarinete Bb 2',\r\n  'clarinete 3': 'Clarinete Bb 3',\r\n  'clarinetes': 'Clarinete Bb',\r\n  'clarinetes bb': 'Clarinete Bb',\r\n  'clarinetes in bb': 'Clarinete Bb',\r\n  'clarineta bb': 'Clarinete Bb',\r\n  'clarineta bb 1': 'Clarinete Bb 1',\r\n  'clarineta bb 2': 'Clarinete Bb 2',\r\n  'clarineta bb 3': 'Clarinete Bb 3',\r\n  'clarineta': 'Clarinete Bb',\r\n  'clarineta 1': 'Clarinete Bb 1',\r\n  'clarineta 2': 'Clarinete Bb 2',\r\n  'clarineta 3': 'Clarinete Bb 3',\r\n  'clarinet': 'Clarinete Bb',\r\n  'clarinet 1': 'Clarinete Bb 1',\r\n  'clarinet 2': 'Clarinete Bb 2',\r\n  'clarinet 3': 'Clarinete Bb 3',\r\n  'clarinets': 'Clarinete Bb',\r\n  'clarinets in bb': 'Clarinete Bb',\r\n  'bb clarinet': 'Clarinete Bb',\r\n  'bb clarinet 1': 'Clarinete Bb 1',\r\n  'bb clarinet 2': 'Clarinete Bb 2',\r\n  'bb clarinet 3': 'Clarinete Bb 3',\r\n  'clarinet in bb': 'Clarinete Bb',\r\n\r\n  // Saxofones\r\n  'sax soprano': 'Sax. Soprano',\r\n  'sax. soprano': 'Sax. Soprano',\r\n  'saxofone soprano': 'Sax. Soprano',\r\n  'soprano sax': 'Sax. Soprano',\r\n  'soprano saxophone': 'Sax. Soprano',\r\n  'saxophone soprano': 'Sax. Soprano',\r\n\r\n  'sax alto': 'Sax. Alto',\r\n  'sax. alto': 'Sax. Alto',\r\n  'sax alto 1': 'Sax. Alto 1',\r\n  'sax. alto 1': 'Sax. Alto 1',\r\n  'sax alto 2': 'Sax. Alto 2',\r\n  'sax. alto 2': 'Sax. Alto 2',\r\n  'saxofone alto': 'Sax. Alto',\r\n  'alto sax': 'Sax. Alto',\r\n  'alto sax 1': 'Sax. Alto 1',\r\n  'alto sax 2': 'Sax. Alto 2',\r\n  'alto saxophone': 'Sax. Alto',\r\n  'saxophone alto': 'Sax. Alto',\r\n\r\n  'sax tenor': 'Sax. Tenor',\r\n  'sax. tenor': 'Sax. Tenor',\r\n  'sax tenor 1': 'Sax. Tenor 1',\r\n  'sax. tenor 1': 'Sax. Tenor 1',\r\n  'sax tenor 2': 'Sax. Tenor 2',\r\n  'sax. tenor 2': 'Sax. Tenor 2',\r\n  'saxofone tenor': 'Sax. Tenor',\r\n  'tenor sax': 'Sax. Tenor',\r\n  'tenor sax 1': 'Sax. Tenor 1',\r\n  'tenor sax 2': 'Sax. Tenor 2',\r\n  'tenor saxophone': 'Sax. Tenor',\r\n  'saxophone tenor': 'Sax. Tenor',\r\n\r\n  'sax baritono': 'Sax. Baritono',\r\n  'sax. baritono': 'Sax. Baritono',\r\n  'saxofone baritono': 'Sax. Baritono',\r\n  'baritone sax': 'Sax. Baritono',\r\n  'baritono sax': 'Sax. Baritono',\r\n  'bari sax': 'Sax. Baritono',\r\n  'baritone saxophone': 'Sax. Baritono',\r\n  'saxophone baritone': 'Sax. Baritono',\r\n\r\n  // Sax Horn (novo!)\r\n  'sax horn': 'Sax Horn Eb',\r\n  'sax horn eb': 'Sax Horn Eb',\r\n  'saxhorn': 'Sax Horn Eb',\r\n  'saxhorn eb': 'Sax Horn Eb',\r\n  'sax-horn': 'Sax Horn Eb',\r\n  'sax-horn eb': 'Sax Horn Eb',\r\n  'alto horn': 'Sax Horn Eb',\r\n  'tenor horn': 'Sax Horn Eb',\r\n\r\n  // Trompetes\r\n  'trompete bb': 'Trompete Bb',\r\n  'trompete bb 1': 'Trompete Bb 1',\r\n  'trompete bb 2': 'Trompete Bb 2',\r\n  'trompete bb 3': 'Trompete Bb 3',\r\n  'trompete': 'Trompete Bb',\r\n  'trompete 1': 'Trompete Bb 1',\r\n  'trompete 2': 'Trompete Bb 2',\r\n  'trompete 3': 'Trompete Bb 3',\r\n  'trompetes': 'Trompete Bb',\r\n  'trompetes bb': 'Trompete Bb',\r\n  'trumpet': 'Trompete Bb',\r\n  'trumpet 1': 'Trompete Bb 1',\r\n  'trumpet 2': 'Trompete Bb 2',\r\n  'trumpet 3': 'Trompete Bb 3',\r\n  'trumpets': 'Trompete Bb',\r\n  'trumpets bb': 'Trompete Bb',\r\n  'bb trumpet': 'Trompete Bb',\r\n  'bb trumpet 1': 'Trompete Bb 1',\r\n  'bb trumpet 2': 'Trompete Bb 2',\r\n  'bb trumpet 3': 'Trompete Bb 3',\r\n  'trumpet in bb': 'Trompete Bb',\r\n  'trumpet in bb 1': 'Trompete Bb 1',\r\n  'trumpet in bb 2': 'Trompete Bb 2',\r\n  'trumpet in bb 3': 'Trompete Bb 3',\r\n\r\n  // Trompas\r\n  'trompa f': 'Trompa F',\r\n  'trompa f 1': 'Trompa F 1',\r\n  'trompa f 2': 'Trompa F 2',\r\n  'trompa f 3': 'Trompa F 3',\r\n  'trompa f 4': 'Trompa F 4',\r\n  'trompa eb': 'Trompa Eb',\r\n  'trompa eb 1': 'Trompa Eb 1',\r\n  'trompa eb 2': 'Trompa Eb 2',\r\n  'trompa': 'Trompa F',\r\n  'trompa 1': 'Trompa F 1',\r\n  'trompa 2': 'Trompa F 2',\r\n  'trompa 3': 'Trompa F 3',\r\n  'trompa 4': 'Trompa F 4',\r\n  'trompas': 'Trompa F',\r\n  'trompas in f': 'Trompa F',\r\n  'horn': 'Trompa F',\r\n  'horn 1': 'Trompa F 1',\r\n  'horn 2': 'Trompa F 2',\r\n  'horn 3': 'Trompa F 3',\r\n  'horn 4': 'Trompa F 4',\r\n  'horns': 'Trompa F',\r\n  'french horn': 'Trompa F',\r\n  'f horn': 'Trompa F',\r\n  'eb horn': 'Trompa Eb',\r\n  'horn in f': 'Trompa F',\r\n  'horn in f 1': 'Trompa F 1',\r\n  'horn in f 2': 'Trompa F 2',\r\n  'horns in f': 'Trompa F',\r\n  'horn in eb': 'Trompa Eb',\r\n  'horn in eb 1': 'Trompa Eb 1',\r\n  'horn in eb 2': 'Trompa Eb 2',\r\n  'horns in eb': 'Trompa Eb',\r\n\r\n  // Baritono (com acento!)\r\n  'baritono bb': 'Baritono Bb',\r\n  'baritono bb 1': 'Baritono Bb 1',\r\n  'baritono bb 2': 'Baritono Bb 2',\r\n  'baritono': 'Baritono Bb',\r\n  'baritono 1': 'Baritono Bb 1',\r\n  'baritono 2': 'Baritono Bb 2',\r\n  'baritone': 'Baritono Bb',\r\n  'baritone 1': 'Baritono Bb 1',\r\n  'baritone 2': 'Baritono Bb 2',\r\n  'baritone tc': 'Baritono TC',\r\n  'baritone t c': 'Baritono TC',\r\n  'baritone bc': 'Baritono BC',\r\n  'baritone b c': 'Baritono BC',\r\n\r\n  // Trombones\r\n  'trombone': 'Trombone',\r\n  'trombone 1': 'Trombone 1',\r\n  'trombone 2': 'Trombone 2',\r\n  'trombone 3': 'Trombone 3',\r\n  'trombones': 'Trombone',\r\n\r\n  // Bombardinos / Eufonio\r\n  'bombardino': 'Bombardino',\r\n  'bombardino bb': 'Bombardino',\r\n  'bombardino c': 'Bombardino',\r\n  'bombardino eb': 'Bombardino',\r\n  'euphonium': 'Bombardino',\r\n  'euphonium 1': 'Bombardino',\r\n  'euphonium 2': 'Bombardino',\r\n  'euphonium bombardino': 'Bombardino',\r\n  'eufonio': 'Bombardino',\r\n\r\n  // Tubas/Baixos\r\n  'baixo eb': 'Baixo Eb',\r\n  'baixo bb': 'Baixo Bb',\r\n  'baixo': 'Baixo Eb',\r\n  'tuba': 'Tuba',\r\n  'tuba eb': 'Tuba Eb',\r\n  'tuba bb': 'Tuba Bb',\r\n  'tuba c': 'Tuba C',\r\n  'bass': 'Baixo Eb',\r\n  'eb bass': 'Baixo Eb',\r\n  'bb bass': 'Baixo Bb',\r\n  'c bass': 'Baixo C',\r\n  'bass tuba': 'Tuba',\r\n  'contrabass': 'Tuba',\r\n\r\n  // Percussao (com acento!)\r\n  'caixa': 'Caixa',\r\n  'caixa clara': 'Caixa',\r\n  'caixa-clara': 'Caixa',\r\n  'snare': 'Caixa',\r\n  'snare drum': 'Caixa',\r\n  'caixa ferro tamborim': 'Caixa',\r\n  'caixa-ferro-tamborim': 'Caixa',\r\n  'caixa e tamborim': 'Caixa',\r\n  'tamborim': 'Caixa',\r\n\r\n  'bombo': 'Bombo',\r\n  'bumbo': 'Bombo',\r\n  'bass drum': 'Bombo',\r\n\r\n  'pratos': 'Pratos',\r\n  'prato': 'Pratos',\r\n  'cymbals': 'Pratos',\r\n  'cymbal': 'Pratos',\r\n\r\n  // Timpano\r\n  'timpano': 'Timpano',\r\n  'timpani': 'Timpano',\r\n  'timpanos': 'Timpano',\r\n  'kettle drum': 'Timpano',\r\n  'kettledrum': 'Timpano',\r\n\r\n  // Triangulo\r\n  'triangulo': 'Triangulo',\r\n  'triangle': 'Triangulo',\r\n\r\n  // Glockenspiel\r\n  'glockenspiel': 'Glockenspiel',\r\n  'glock': 'Glockenspiel',\r\n  'bells': 'Glockenspiel',\r\n  'orchestra bells': 'Glockenspiel',\r\n\r\n  // Zabumba\r\n  'zabumba': 'Zabumba',\r\n\r\n  // Jam Block\r\n  'jam block': 'Jam Block',\r\n  'jamblock': 'Jam Block',\r\n  'wood block': 'Wood Block',\r\n  'woodblock': 'Wood Block',\r\n\r\n  // Percussao multipla/geral\r\n  'percussao': 'Percussao',\r\n  'percussion': 'Percussao',\r\n  'drums': 'Percussao',\r\n  'bateria': 'Percussao',\r\n  'drum set': 'Percussao',\r\n  'bombo pratos': 'Bombo e Pratos',\r\n  'bumbo pratos': 'Bombo e Pratos',\r\n  'bombo e pratos': 'Bombo e Pratos',\r\n  'bumbo e pratos': 'Bombo e Pratos'\r\n};\r\n\r\n// Cache para chaves ordenadas (inicializado uma vez)\r\nlet chavesOrdenadasCache: string[] | null = null;\r\n\r\n/**\r\n * Retorna chaves do nomesPadrao ordenadas por tamanho (maior para menor)\r\n * Usa cache para evitar reprocessamento em cada chamada (380+ chaves)\r\n */\r\nconst getChavesOrdenadas = (): string[] => {\r\n  if (chavesOrdenadasCache === null) {\r\n    chavesOrdenadasCache = Object.keys(nomesPadrao).sort((a, b) => b.length - a.length);\r\n  }\r\n  return chavesOrdenadasCache;\r\n};\r\n\r\n/**\r\n * Corrige encoding corrompido (UTF-8 lido como Latin-1)\r\n * Ex: \"JoA£o\" -> \"Joao\", \"BarA­tono\" -> \"Baritono\"\r\n */\r\nexport const corrigirEncoding = (texto: string): string => {\r\n  if (!texto) return '';\r\n\r\n  // Mapeamento de sequencias corrompidas comuns (UTF-8 -> caractere correto)\r\n  const correcoes: Record<string, string> = {\r\n    '\\u00C3\\u00A3': '\\u00E3', '\\u00C3\\u00A1': '\\u00E1', '\\u00C3\\u00A9': '\\u00E9', '\\u00C3\\u00AD': '\\u00ED', '\\u00C3\\u00B3': '\\u00F3', '\\u00C3\\u00BA': '\\u00FA',\r\n    '\\u00C3\\u00A7': '\\u00E7', '\\u00C3\\u00B1': '\\u00F1', '\\u00C3\\u00A2': '\\u00E2', '\\u00C3\\u00AA': '\\u00EA', '\\u00C3\\u00AE': '\\u00EE', '\\u00C3\\u00B4': '\\u00F4',\r\n    '\\u00C3\\u00BB': '\\u00FB', '\\u00C3\\u00A0': '\\u00E0', '\\u00C3\\u00A8': '\\u00E8', '\\u00C3\\u00AC': '\\u00EC', '\\u00C3\\u00B2': '\\u00F2', '\\u00C3\\u00B9': '\\u00F9',\r\n    '\\u00C3\\u0080': '\\u00C0', '\\u00C3\\u0089': '\\u00C9', '\\u00C3\\u008D': '\\u00CD', '\\u00C3\\u0093': '\\u00D3', '\\u00C3\\u009A': '\\u00DA',\r\n    '\\u00C3\\u0087': '\\u00C7', '\\u00C3\\u0083': '\\u00C3', '\\u00C3\\u0095': '\\u00D5',\r\n    // Sequencias menores (cuidado com ordem)\r\n    '\\u00E3': '\\u00E3', '\\u00E1': '\\u00E1', '\\u00E9': '\\u00E9', '\\u00ED': '\\u00ED', '\\u00F3': '\\u00F3', '\\u00FA': '\\u00FA', '\\u00E7': '\\u00E7'\r\n  };\r\n\r\n  let resultado = texto;\r\n\r\n  // Aplica correcoes do maior para o menor padrao\r\n  const padroes = Object.keys(correcoes).sort((a, b) => b.length - a.length);\r\n  for (const padrao of padroes) {\r\n    resultado = resultado.split(padrao).join(correcoes[padrao]);\r\n  }\r\n\r\n  return resultado;\r\n};\r\n\r\n/**\r\n * Normaliza texto removendo acentos e padronizando espacos\r\n */\r\nexport const normalizarTexto = (texto: string): string => {\r\n  if (!texto) return '';\r\n\r\n  // Primeiro corrige encoding corrompido\r\n  const textoCorrigido = corrigirEncoding(texto);\r\n\r\n  return textoCorrigido\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/[_\\-.]/g, ' ')\r\n    .replace(/\\s+/g, ' ')\r\n    .trim();\r\n};\r\n\r\nexport interface InstrumentoResult {\r\n  instrumento: string;\r\n  reconhecido: boolean;\r\n}\r\n\r\n/**\r\n * Extrai instrumento do nome do arquivo PDF\r\n * Suporta formatos:\r\n * - \"01 - Clarinete Bb 1.pdf\" (numero de ordem + instrumento + numero)\r\n * - \"15 III Trompete Bb.pdf\" (numero de ordem + romano + instrumento)\r\n * - \"1o Trompete.pdf\" (ordinal + instrumento)\r\n * - \"I e II Clarinetes in Bb.pdf\" (combinacao romana + instrumento)\r\n * - \"21_Cel._Pedra_-_Dobrado_-_Caixa-clara.pdf\" (padrao com multiplos hifens)\r\n */\r\nexport const extrairInstrumento = (nomeArquivo: string): InstrumentoResult => {\r\n  if (!nomeArquivo) return { instrumento: '', reconhecido: false };\r\n\r\n  // Primeiro corrige encoding do nome do arquivo\r\n  let nome = corrigirEncoding(nomeArquivo);\r\n\r\n  // Remove extensao .pdf\r\n  nome = nome.replace(/\\.pdf$/i, '');\r\n\r\n  // Remove numero de ordem inicial (ex: \"01\", \"15\", \"27\")\r\n  // MAS preserva:\r\n  // - numeros ordinais (1o, 2o, 1deg, 2deg, 1a, 2a) que indicam voz do instrumento\r\n  // - numeros seguidos de \" e \" que indicam partes combinadas (1 e 2)\r\n  nome = nome.replace(/^\\d+(?![ºª°]|\\s*e\\s*\\d)[\\s\\-_.]*/, '');\r\n\r\n  // Para arquivos com padrao \"Nome_-_Tipo_-_Autor_-_Instrumento\", pega o ultimo segmento\r\n  // Isso preserva instrumentos com hifen como \"Caixa-clara\"\r\n  if (nome.includes('_-_') || nome.includes(' - ')) {\r\n    const separador = nome.includes('_-_') ? '_-_' : ' - ';\r\n    const partes = nome.split(separador);\r\n    // Pega a ultima parte que deve ser o instrumento\r\n    const ultimaParte = partes[partes.length - 1].trim();\r\n    // So usa se nao for uma palavra muito curta ou vazia\r\n    if (ultimaParte.length > 2) {\r\n      nome = ultimaParte;\r\n    }\r\n  }\r\n\r\n  // Remove parenteses e seu conteudo para analise (ex: \"(T.C)\" -> guardamos para depois)\r\n  const matchParenteses = nome.match(/\\(([^)]+)\\)/);\r\n  const conteudoParenteses = matchParenteses ? matchParenteses[1].toLowerCase() : null;\r\n  let nomeParaAnalise = nome.replace(/\\s*\\([^)]+\\)\\s*/g, ' ').trim();\r\n\r\n  // Verifica se ha numero/romano no INICIO indicando a voz (I, II, III, 1, 2, 3, 1o, 2o)\r\n  const prefixoInfo = extrairNumeroPrefixo(nomeParaAnalise);\r\n  const numeroPrefixo = prefixoInfo.numero;\r\n  let partesCombinadas = prefixoInfo.combinado;\r\n  let numerosCombinados = prefixoInfo.numerosCombinados;\r\n  nomeParaAnalise = prefixoInfo.resto;\r\n\r\n  // Normaliza o nome para busca\r\n  const nomeNormalizado = normalizarTexto(nomeParaAnalise);\r\n\r\n  // Verifica se ha combinacao no FINAL (ex: \"Flautas I e II\", \"Trompete 1 e 2\")\r\n  const matchCombinadoFinal = nomeNormalizado.match(/\\s+(i+|iv|v|vi+|ix|x|\\d+)\\s*e\\s*(i+|iv|v|vi+|ix|x|\\d+)$/i);\r\n  if (matchCombinadoFinal && !partesCombinadas) {\r\n    const num1 = converterParaNumero(matchCombinadoFinal[1]);\r\n    const num2 = converterParaNumero(matchCombinadoFinal[2]);\r\n    if (num1 && num2) {\r\n      partesCombinadas = true;\r\n      numerosCombinados = `${num1} e ${num2}`;\r\n    }\r\n  }\r\n\r\n  // Remove combinacao do final para obter o nome base\r\n  let nomeBaseNormalizado = nomeNormalizado.replace(/\\s+(i+|iv|v|vi+|ix|x|\\d+)\\s*e\\s*(i+|iv|v|vi+|ix|x|\\d+)$/i, '').trim();\r\n\r\n  // Verifica se ha numero no FINAL (ex: \"Clarinete Bb 1\")\r\n  const matchNumeroFinal = nomeBaseNormalizado.match(/\\s+(\\d+)$/);\r\n  const numeroFinal = matchNumeroFinal ? parseInt(matchNumeroFinal[1], 10) : null;\r\n  nomeBaseNormalizado = nomeBaseNormalizado.replace(/\\s+\\d+$/, '').trim();\r\n\r\n  // Determina o numero da voz (prioridade: prefixo > final)\r\n  const numeroVoz = numeroPrefixo || numeroFinal;\r\n\r\n  // Funcao para adicionar numero a identificacao final\r\n  const formatarResultado = (instrumentoBase: string): string => {\r\n    // Se partes combinadas, adiciona \"1 e 2\" (ou similar) ao nome\r\n    if (partesCombinadas && numerosCombinados) {\r\n      return `${instrumentoBase} ${numerosCombinados}`;\r\n    }\r\n    // Se ja tem numero no nome base, usa ele\r\n    if (/\\d$/.test(instrumentoBase)) {\r\n      return instrumentoBase;\r\n    }\r\n    // Adiciona numero da voz se existir\r\n    if (numeroVoz) {\r\n      return `${instrumentoBase} ${numeroVoz}`;\r\n    }\r\n    return instrumentoBase;\r\n  };\r\n\r\n  // Tenta busca exata primeiro\r\n  if (nomesPadrao[nomeBaseNormalizado]) {\r\n    return { instrumento: formatarResultado(nomesPadrao[nomeBaseNormalizado]), reconhecido: true };\r\n  }\r\n\r\n  // Tenta com o nome completo normalizado (pode ter numero)\r\n  if (nomesPadrao[nomeNormalizado]) {\r\n    return { instrumento: formatarResultado(nomesPadrao[nomeNormalizado]), reconhecido: true };\r\n  }\r\n\r\n  // Busca parcial usando cache otimizado (maior para menor para evitar falsos positivos)\r\n  const chavesOrdenadas = getChavesOrdenadas();\r\n  for (const chave of chavesOrdenadas) {\r\n    if (nomeBaseNormalizado.includes(chave) || nomeBaseNormalizado.endsWith(chave)) {\r\n      return { instrumento: formatarResultado(nomesPadrao[chave]), reconhecido: true };\r\n    }\r\n  }\r\n\r\n  // Verifica conteudo dos parenteses para casos como \"Euphonium (bombardino)\"\r\n  if (conteudoParenteses && nomesPadrao[conteudoParenteses]) {\r\n    return { instrumento: formatarResultado(nomesPadrao[conteudoParenteses]), reconhecido: true };\r\n  }\r\n\r\n  // Se nao reconheceu, retorna nome original (corrigido de encoding)\r\n  const nomeRetorno = nome.trim();\r\n  // Tenta ao menos adicionar o numero da voz se identificado\r\n  if (numeroVoz && !/\\d/.test(nomeRetorno)) {\r\n    return { instrumento: `${nomeRetorno} ${numeroVoz}`, reconhecido: false };\r\n  }\r\n  return { instrumento: nomeRetorno, reconhecido: false };\r\n};\r\n\r\n// Alias for backward compatibility\r\nexport const detectInstrumento = (filename: string): string | null => {\r\n  const result = extrairInstrumento(filename);\r\n  return result.reconhecido ? result.instrumento : null;\r\n};\r\n\r\nexport default extrairInstrumento;\r\n","// ===== METADATA PARSER =====\r\n// Funcoes para extrair metadados de nomes de pastas e detectar categorias\r\n// Extraido de UploadPastaModal.jsx para reutilizacao\r\n\r\nimport { normalizarTexto } from './instrumentParser';\r\n\r\n// Categorias conhecidas para deteccao automatica\r\nconst CATEGORIAS_CONHECIDAS: string[] = [\r\n  'dobrado', 'marcha', 'valsa', 'fantasia', 'polaca',\r\n  'bolero', 'hino', 'marcha funebre', 'marcha religiosa',\r\n  'preludio', 'arranjo', 'hino religioso', 'hino civico'\r\n];\r\n\r\n// Mapeamento de termos para IDs de categoria\r\n// IMPORTANTE: Termos mais especificos devem vir antes dos genericos\r\n// A funcao detectarCategoria ordena por comprimento, entao isso e automatico\r\nconst MAPEAMENTO_CATEGORIAS: Record<string, string> = {\r\n  'dobrado': 'dobrado',\r\n  'dobrados': 'dobrado',\r\n  // Marchas - especificas primeiro\r\n  'marcha funebre': 'marcha-funebre',\r\n  'marcha fúnebre': 'marcha-funebre',\r\n  'marchas funebres': 'marcha-funebre',\r\n  'marchas fúnebres': 'marcha-funebre',\r\n  'marcha religiosa': 'marcha-religiosa',\r\n  'marchas religiosas': 'marcha-religiosa',\r\n  'marcha': 'marcha',\r\n  'marchas': 'marcha',\r\n  'valsa': 'valsa',\r\n  'valsas': 'valsa',\r\n  'fantasia': 'fantasia',\r\n  'fantasias': 'fantasia',\r\n  'suite': 'fantasia',\r\n  'polaca': 'polaca',\r\n  'polacas': 'polaca',\r\n  'bolero': 'bolero',\r\n  'boleros': 'bolero',\r\n  // Hinos - especificos primeiro\r\n  'hino religioso': 'hino-religioso',\r\n  'hinos religiosos': 'hino-religioso',\r\n  'sacro': 'hino-religioso',\r\n  'hino civico': 'hino-civico',\r\n  'hinos civicos': 'hino-civico',\r\n  'hino cívico': 'hino-civico',\r\n  'hinos cívicos': 'hino-civico',\r\n  'hino municipal': 'hino-civico',\r\n  'hino nacional': 'hino-civico',\r\n  'hino estadual': 'hino-civico',\r\n  'hino': 'hino',\r\n  'hinos': 'hino',\r\n  'preludio': 'preludio',\r\n  'prelúdio': 'preludio',\r\n  'preludios': 'preludio',\r\n  'arranjo': 'arranjo',\r\n  'arranjos': 'arranjo'\r\n};\r\n\r\nexport interface Categoria {\r\n  id: string;\r\n  nome: string;\r\n}\r\n\r\nexport interface ParseNomePastaResult {\r\n  titulo: string;\r\n  categoriaDetectada: string;\r\n  compositor: string;\r\n  arranjador: string;\r\n}\r\n\r\n/**\r\n * Parseia nome da pasta para extrair titulo, categoria, compositor, arranjador\r\n * Padrao esperado: \"Titulo - Categoria - Compositor\" ou \"Titulo - Arr: Arranjador\"\r\n */\r\nexport const parsearNomePasta = (nome: string): ParseNomePastaResult => {\r\n  if (!nome) {\r\n    return { titulo: '', categoriaDetectada: '', compositor: '', arranjador: '' };\r\n  }\r\n\r\n  const partes = nome.split(/\\s*-\\s*/);\r\n  let titulo = '';\r\n  let categoriaDetectada = '';\r\n  let compositor = '';\r\n  let arranjador = '';\r\n  let temArranjador = false;\r\n\r\n  if (partes.length > 0) {\r\n    titulo = partes[0].trim();\r\n  }\r\n\r\n  for (let i = 1; i < partes.length; i++) {\r\n    const parte = partes[i].trim();\r\n    const parteLower = parte.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n\r\n    // Detecta arranjador\r\n    if (/^arr[:\\s]/i.test(parte) || /arranjo/i.test(parte)) {\r\n      arranjador = parte.replace(/^(arr[:\\s]*|arranjo[.:\\s]*)/i, '').trim();\r\n      temArranjador = true;\r\n    }\r\n    // Detecta categoria\r\n    else if (CATEGORIAS_CONHECIDAS.some(cat => parteLower === cat || parteLower.includes(cat))) {\r\n      categoriaDetectada = parte;\r\n    }\r\n    // Assume compositor\r\n    else if (!compositor) {\r\n      compositor = parte;\r\n    }\r\n  }\r\n\r\n  // Se tem arranjador mas nao tem categoria, assume \"Arranjo\"\r\n  if (temArranjador && !categoriaDetectada) {\r\n    categoriaDetectada = 'Arranjo';\r\n  }\r\n\r\n  return { titulo, categoriaDetectada, compositor, arranjador };\r\n};\r\n\r\n/**\r\n * Detecta categoria pelo nome usando mapeamento\r\n */\r\nexport const detectarCategoria = (nome: string, categorias: Categoria[] = []): string | null => {\r\n  if (!nome) return null;\r\n\r\n  const nomeNorm = nome.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n\r\n  // Ordena termos por comprimento (maior primeiro) para evitar falsos positivos\r\n  // Ex: \"marcha funebre\" deve ser detectado antes de \"marcha\"\r\n  const termos = Object.keys(MAPEAMENTO_CATEGORIAS).sort((a, b) => b.length - a.length);\r\n\r\n  for (const termo of termos) {\r\n    // Normaliza o termo tambem para comparacao consistente\r\n    const termoNorm = termo.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n    if (nomeNorm.includes(termoNorm)) {\r\n      const categoriaId = MAPEAMENTO_CATEGORIAS[termo];\r\n      // Verifica se a categoria existe na lista fornecida\r\n      if (categorias.length === 0 || categorias.some(c => c.id === categoriaId)) {\r\n        return categoriaId;\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport interface CategoriaEstrutura {\r\n  id: string;\r\n  fonte: string;\r\n  confianca: number;\r\n}\r\n\r\n/**\r\n * Detecta categoria pela estrutura de pastas (pasta-pai)\r\n * Ex: \"Repertorio/Dobrados/Dois Coracoes\" -> categoria = dobrado\r\n */\r\nexport const detectarCategoriaPorEstrutura = (caminhoPasta: string, categorias: Categoria[] = []): CategoriaEstrutura | null => {\r\n  if (!caminhoPasta) return null;\r\n\r\n  // Normaliza separadores de caminho\r\n  const caminhoNormalizado = caminhoPasta.replace(/\\\\/g, '/');\r\n  const partes = caminhoNormalizado.split('/').filter(p => p.trim());\r\n\r\n  // Itera das pastas mais proximas (exceto a ultima que e o nome da partitura) para as mais distantes\r\n  for (let i = partes.length - 2; i >= 0; i--) {\r\n    const pastaPai = partes[i];\r\n    const pastaNorm = normalizarTexto(pastaPai);\r\n\r\n    // Busca no mapeamento\r\n    const termos = Object.keys(MAPEAMENTO_CATEGORIAS).sort((a, b) => b.length - a.length);\r\n    for (const termo of termos) {\r\n      const termoNorm = normalizarTexto(termo);\r\n      if (pastaNorm === termoNorm || pastaNorm.includes(termoNorm)) {\r\n        const categoriaId = MAPEAMENTO_CATEGORIAS[termo];\r\n        // Verifica se a categoria existe na lista fornecida\r\n        if (categorias.length === 0 || categorias.some(c => c.id === categoriaId)) {\r\n          return {\r\n            id: categoriaId,\r\n            fonte: 'pasta-pai',\r\n            confianca: 0.95\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    // Busca correspondencia direta com nomes de categoria\r\n    for (const cat of categorias) {\r\n      const catNorm = normalizarTexto(cat.nome);\r\n      if (pastaNorm === catNorm || pastaNorm.includes(catNorm) || catNorm.includes(pastaNorm)) {\r\n        return {\r\n          id: cat.id,\r\n          fonte: 'pasta-pai',\r\n          confianca: 0.95\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\n/**\r\n * Remove categoria do inicio do titulo se presente\r\n * Ex: \"Dobrado Dois Coracoes\" -> \"Dois Coracoes\"\r\n */\r\nexport const limparCategoriaDoTitulo = (titulo: string, categoriaId: string): string => {\r\n  if (!titulo || !categoriaId) return titulo;\r\n\r\n  const tituloNorm = normalizarTexto(titulo);\r\n\r\n  // Busca termos que correspondem a essa categoria\r\n  // IMPORTANTE: Ordena por comprimento (maior primeiro) para evitar remover termo parcial\r\n  // Ex: \"Marchas Religiosas I\" deve remover \"Marchas Religiosas\", nao apenas \"Marchas\"\r\n  const termosCategoria = Object.entries(MAPEAMENTO_CATEGORIAS)\r\n    .filter(([, id]) => id === categoriaId)\r\n    .map(([termo]) => termo)\r\n    .sort((a, b) => b.length - a.length);\r\n\r\n  for (const termo of termosCategoria) {\r\n    const termoNorm = normalizarTexto(termo);\r\n    // Verifica se o titulo comeca com o termo da categoria\r\n    if (tituloNorm.startsWith(termoNorm)) {\r\n      // Remove o termo do inicio e limpa espacos\r\n      // Escapa caracteres especiais de regex no termo\r\n      const termoEscapado = termo.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n      const regex = new RegExp(`^${termoEscapado}\\\\s*`, 'i');\r\n      const tituloLimpo = titulo.replace(regex, '').trim();\r\n      if (tituloLimpo) {\r\n        return tituloLimpo;\r\n      }\r\n    }\r\n  }\r\n\r\n  return titulo;\r\n};\r\n\r\nexport interface MetadataResult {\r\n  titulo: string;\r\n  categoria: string | null;\r\n  categoriaConfianca: number;\r\n  categoriaFonte: string;\r\n  compositor: string;\r\n  arranjador: string;\r\n}\r\n\r\n/**\r\n * Analisa uma pasta e extrai todos os metadados com deteccao multi-camada\r\n */\r\nexport const analisarMetadados = (caminhoPasta: string, nomePasta: string, categorias: Categoria[] = []): MetadataResult => {\r\n  const resultado: MetadataResult = {\r\n    titulo: nomePasta,\r\n    categoria: null,\r\n    categoriaConfianca: 0,\r\n    categoriaFonte: 'nenhuma',\r\n    compositor: '',\r\n    arranjador: ''\r\n  };\r\n\r\n  // Camada 1: Detecta por estrutura de pastas (mais confiavel - 95%)\r\n  const categoriaPorEstrutura = detectarCategoriaPorEstrutura(caminhoPasta, categorias);\r\n  if (categoriaPorEstrutura) {\r\n    resultado.categoria = categoriaPorEstrutura.id;\r\n    resultado.categoriaConfianca = categoriaPorEstrutura.confianca;\r\n    resultado.categoriaFonte = categoriaPorEstrutura.fonte;\r\n  }\r\n\r\n  // Camada 2: Parse do nome da pasta\r\n  const parseado = parsearNomePasta(nomePasta);\r\n  resultado.titulo = parseado.titulo || nomePasta;\r\n  resultado.compositor = parseado.compositor;\r\n  resultado.arranjador = parseado.arranjador;\r\n\r\n  // Se ainda nao tem categoria, tenta pelo nome parseado (85%)\r\n  if (!resultado.categoria && parseado.categoriaDetectada) {\r\n    const catId = detectarCategoria(parseado.categoriaDetectada, categorias);\r\n    if (catId) {\r\n      resultado.categoria = catId;\r\n      resultado.categoriaConfianca = 0.85;\r\n      resultado.categoriaFonte = 'nome-pasta';\r\n    }\r\n  }\r\n\r\n  // Camada 3: Tenta detectar categoria no titulo (75%)\r\n  if (!resultado.categoria) {\r\n    const catNoTitulo = detectarCategoria(resultado.titulo, categorias);\r\n    if (catNoTitulo) {\r\n      resultado.categoria = catNoTitulo;\r\n      resultado.categoriaConfianca = 0.75;\r\n      resultado.categoriaFonte = 'titulo';\r\n      // Limpa categoria do titulo\r\n      resultado.titulo = limparCategoriaDoTitulo(resultado.titulo, catNoTitulo);\r\n    }\r\n  }\r\n\r\n  return resultado;\r\n};\r\n\r\n// Exporta constantes para uso externo\r\nexport { CATEGORIAS_CONHECIDAS, MAPEAMENTO_CATEGORIAS };\r\n\r\nexport default analisarMetadados;\r\n"],"names":[],"mappings":"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"}