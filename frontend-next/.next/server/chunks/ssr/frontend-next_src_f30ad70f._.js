module.exports=[99419,a=>{"use strict";let b;var c=a.i(42485),d=a.i(66592),e=a.i(63840),f=a.i(40811);let g=[{id:"dobrados",name:"Dobrados"},{id:"marchas",name:"Marchas"},{id:"marchas-funebres",name:"Marchas Fúnebres"},{id:"marchas-religiosas",name:"Marchas Religiosas"},{id:"fantasias",name:"Fantasias"},{id:"polacas",name:"Polacas"},{id:"boleros",name:"Boleros"},{id:"valsas",name:"Valsas"},{id:"arranjos",name:"Arranjos"},{id:"hinos",name:"Hinos"},{id:"hinos-civicos",name:"Hinos Cívicos"},{id:"hinos-religiosos",name:"Hinos Religiosos"},{id:"preludios",name:"Prelúdios"}];g.map(a=>[a.id,a]);let h=[{id:1,nome:"Grade"},{id:2,nome:"Flautim"},{id:3,nome:"Flauta"},{id:4,nome:"Requinta"},{id:5,nome:"Clarinete Bb"},{id:6,nome:"Clarinete Bb 1"},{id:7,nome:"Clarinete Bb 2"},{id:8,nome:"Sax. Soprano"},{id:9,nome:"Sax. Alto"},{id:10,nome:"Sax. Alto 1"},{id:11,nome:"Sax. Alto 2"},{id:12,nome:"Sax. Tenor"},{id:13,nome:"Sax. Tenor 1"},{id:14,nome:"Sax. Tenor 2"},{id:15,nome:"Sax. Barítono"},{id:16,nome:"Trompete Bb"},{id:17,nome:"Trompete Bb 1"},{id:18,nome:"Trompete Bb 2"},{id:19,nome:"Trompa F"},{id:20,nome:"Trompa Eb"},{id:21,nome:"Trompa Eb 1"},{id:22,nome:"Trompa Eb 2"},{id:23,nome:"Barítono Bb"},{id:24,nome:"Barítono Bb 1"},{id:25,nome:"Barítono Bb 2"},{id:26,nome:"Trombone"},{id:27,nome:"Trombone 1"},{id:28,nome:"Trombone 2"},{id:29,nome:"Bombardino"},{id:30,nome:"Bombardino Bb"},{id:31,nome:"Baixo Eb"},{id:32,nome:"Baixo Bb"},{id:33,nome:"Caixa"},{id:34,nome:"Bombo"},{id:35,nome:"Pratos"}];h.map(a=>a.nome),b=new Map,h.forEach(a=>{b.set(a.nome.toLowerCase(),a)});let i=(0,d.createContext)(null);a.s(["DataProvider",0,({children:a})=>{let[b,j]=(0,d.useState)(()=>e.default.get("sheets",[{id:"1",title:"Verde e Branco",composer:"Estevam Moura",category:"dobrados",year:1940,downloads:567,featured:!0},{id:"2",title:"Magnata",composer:"Estevam Moura",category:"dobrados",year:1945,downloads:489,featured:!0},{id:"3",title:"Tusca",composer:"Estevam Moura",category:"dobrados",year:1942,downloads:423,featured:!1},{id:"4",title:"Dois Corações",composer:"Pedro Salgado",category:"dobrados",year:1935,downloads:512,featured:!0},{id:"5",title:"Os Corujas",composer:"Heraclio Guerreiro",category:"dobrados",year:1920,downloads:298,featured:!0}])),[k,l]=(0,d.useState)(!0),[m,n]=(0,d.useState)(!1),[o,p]=(0,d.useState)(()=>e.default.get("categories",null)||g),[q,r]=(0,d.useState)(()=>e.default.get("instruments",null)||h),[s,t]=(0,d.useState)(()=>e.default.get("favorites",[])),[u,v]=(0,d.useState)("home"),[w,x]=(0,d.useState)(null),[y,z]=(0,d.useState)(null),[A,B]=(0,d.useState)("");(0,d.useEffect)(()=>{(async()=>{if(!f.USE_API)return l(!1);try{let a=await f.API.healthCheck();if(n(a),a){let[a,b,c]=await Promise.all([f.API.getPartituras(),f.API.getCategorias(),f.API.getInstrumentos()]);if(a&&a.length>0){let b=a.map(a=>({id:String(a.id),title:a.titulo,composer:a.compositor,category:a.categoria_id,year:a.ano,downloads:a.downloads||0,featured:1===a.destaque,hasFile:!!a.arquivo_nome,apiId:a.id}));j(b),e.default.set("sheets",b)}if(b&&b.length>0){let a=b.map(a=>({id:a.id,name:a.nome}));p(a),e.default.set("categories",a)}if(c&&c.length>0){let a=c.map(a=>({id:a.id,nome:a.nome}));r(a),e.default.set("instruments",a)}}}catch(a){console.error("Erro ao carregar da API:",a)}finally{l(!1)}})()},[]),(0,d.useEffect)(()=>{e.default.set("sheets",b)},[b]),(0,d.useEffect)(()=>{e.default.set("favorites",s)},[s]),(0,d.useEffect)(()=>{e.default.set("categories",o)},[o]),(0,d.useEffect)(()=>{e.default.set("instruments",q)},[q]);let C=(0,d.useMemo)(()=>new Map(o.map(a=>[a.id,a])),[o]),D=(0,d.useMemo)(()=>q.map(a=>a.nome),[q]),E=(0,d.useCallback)(async()=>{let a=e.default.get("authToken",null);if(f.USE_API&&a)try{let a=await f.API.getFavoritosIds();if(a&&Array.isArray(a)){let b=a.map(a=>String(a));t(b),e.default.set("favorites",b)}}catch{}},[]),F=(0,d.useCallback)(a=>{let b=e.default.get("authToken",null);t(c=>{let d=c.includes(a),e=d?c.filter(b=>b!==a):[...c,a];return f.USE_API&&b&&(d?f.API.removeFavorito(a):f.API.addFavorito(a)).catch(()=>{t(b=>!d===b.includes(a)?d?[...b,a]:b.filter(b=>b!==a):b)}),e})},[]),G=(0,d.useCallback)(a=>{j(b=>[...b,a])},[]);return(0,c.jsx)(i.Provider,{value:{sheets:b,setSheets:j,addSheet:G,favorites:s,setFavorites:t,toggleFavorite:F,loadUserFavorites:E,categories:o,categoriesMap:C,instruments:q,instrumentNames:D,activeTab:u,setActiveTab:v,selectedCategory:w,setSelectedCategory:x,selectedComposer:y,setSelectedComposer:z,searchQuery:A,setSearchQuery:B,isLoading:k,apiOnline:m},children:a})},"useData",0,()=>{let a=(0,d.useContext)(i);if(!a)throw Error("useData must be used within DataProvider");return a}],99419)},63840,6625,40811,a=>{"use strict";let b={get(a,b){try{return b}catch{return b}},set(a,b){try{return}catch{}},remove(a){try{return}catch{}},clear(a){try{return}catch{}}};a.s(["Storage",0,b,"default",0,b],63840);let c=process.env.NEXT_PUBLIC_API_URL||"https://acervo-filarmonica-api.acssjr.workers.dev";a.s(["API_BASE_URL",0,c,"TOKEN_EXPIRY_BUFFER_MS",0,3e5],6625);let d=null;a.s(["API",0,{setOnTokenExpired(a){d=a},isTokenExpired(){let a=b.get("authToken",null),c=b.get("tokenExpiresAt",null);return!!a&&(!c||Date.now()>c-3e5)},clearAuth(){b.remove("authToken"),b.remove("tokenExpiresAt"),b.remove("user")},async request(a,e={}){try{if(this.isTokenExpired())throw this.clearAuth(),d&&d(),Error("Sessão expirada. Faça login novamente.");let f=b.get("authToken",null),g={"Content-Type":"application/json",...f&&{Authorization:`Bearer ${f}`},...e.headers},h=await fetch(`${c}${a}`,{...e,headers:g});if(401===h.status){let a=await h.json().catch(()=>({error:"Não autorizado"}));throw this.clearAuth(),d&&d(),Error(a.error||"Sessão expirada. Faça login novamente.")}if(!h.ok){let a=await h.json().catch(()=>({error:"Erro desconhecido"}));throw Error(a.error||`HTTP ${h.status}`)}return await h.json()}catch(b){throw console.error(`API Error [${a}]:`,b),b}},async getPartituras(a={}){let b=new URLSearchParams;a.categoria&&b.append("categoria",a.categoria),a.busca&&b.append("busca",a.busca),a.destaque&&b.append("destaque","1");let c=b.toString();return this.request(`/api/partituras${c?`?${c}`:""}`)},async getPartitura(a){return this.request(`/api/partituras/${a}`)},async createPartitura(a){let d=b.get("authToken",null),e=await fetch(`${c}/api/partituras`,{method:"POST",headers:{...d&&{Authorization:`Bearer ${d}`}},body:a});if(!e.ok)throw Error((await e.json().catch(()=>({error:"Erro no upload"}))).error);return e.json()},async updatePartitura(a,b){return this.request(`/api/partituras/${a}`,{method:"PUT",body:JSON.stringify(b)})},async deletePartitura(a){return this.request(`/api/partituras/${a}`,{method:"DELETE"})},async uploadPastaPartitura(a){let d=b.get("authToken",null),e=await fetch(`${c}/api/partituras/upload-pasta`,{method:"POST",headers:{...d&&{Authorization:`Bearer ${d}`}},body:a});if(!e.ok)throw Error((await e.json().catch(()=>({error:"Erro no upload"}))).error);return e.json()},async getPartesPartitura(a){return this.request(`/api/partituras/${a}/partes`)},async addPartePartitura(a,d){let e=b.get("authToken",null),f=await fetch(`${c}/api/partituras/${a}/partes`,{method:"POST",headers:{...e&&{Authorization:`Bearer ${e}`}},body:d});if(!f.ok)throw Error((await f.json().catch(()=>({error:"Erro ao adicionar parte"}))).error);return f.json()},async replacePartePartitura(a,d,e){let f=b.get("authToken",null),g=await fetch(`${c}/api/partes/${d}/substituir`,{method:"PUT",headers:{...f&&{Authorization:`Bearer ${f}`}},body:e});if(!g.ok)throw Error((await g.json().catch(()=>({error:"Erro ao substituir parte"}))).error);return g.json()},async deletePartePartitura(a,b){return this.request(`/api/partes/${b}`,{method:"DELETE"})},getDownloadUrl(a,b=null){let d=`${c}/api/download/${a}`;return b&&(d+=`?instrumento=${b}`),d},async getCategorias(){return this.request("/api/categorias")},async getInstrumentos(){return this.request("/api/instrumentos")},async getEstatisticas(){return this.request("/api/estatisticas")},async getAtividades(){return this.request("/api/atividades")},async getMinhasAtividades(){return this.request("/api/minhas-atividades")},async login(a,c,d=!1){let e=await this.request("/api/login",{method:"POST",body:JSON.stringify({username:a,pin:c,rememberMe:d})});if(e.token&&(b.set("authToken",e.token),e.expiresIn)){let a=Date.now()+1e3*e.expiresIn;b.set("tokenExpiresAt",a)}return e},async changePin(a,c){try{let d=await this.request("/api/change-pin",{method:"POST",body:JSON.stringify({currentPin:a,newPin:c})});if(d.token){b.set("authToken",d.token);let a=Date.now()+864e5;b.set("tokenExpiresAt",a)}return d}catch(a){return{success:!1,error:a instanceof Error?a.message:"Erro desconhecido"}}},logout(){this.clearAuth()},async healthCheck(){try{let a=await this.request("/api/health");return"ok"===a.status}catch{return!1}},async getVersion(){try{return await this.request("/api/version")}catch{return null}},async getPerfil(){return this.request("/api/perfil")},async updatePerfil(a){return this.request("/api/perfil",{method:"PUT",body:JSON.stringify(a)})},async uploadFotoPerfil(a){let d=b.get("authToken",null),e=new FormData;e.append("foto",a);let f=await fetch(`${c}/api/perfil/foto`,{method:"POST",headers:{...d&&{Authorization:`Bearer ${d}`}},body:e});if(!f.ok)throw Error((await f.json().catch(()=>({error:"Erro no upload"}))).error);return f.json()},async getFavoritos(){return this.request("/api/favoritos")},async getFavoritosIds(){return this.request("/api/favoritos/ids")},async addFavorito(a){return this.request(`/api/favoritos/${a}`,{method:"POST"})},async removeFavorito(a){return this.request(`/api/favoritos/${a}`,{method:"DELETE"})},async getUsuarios(){return this.request("/api/usuarios")},async getUsuario(a){return this.request(`/api/usuarios/${a}`)},async createUsuario(a){return this.request("/api/usuarios",{method:"POST",body:JSON.stringify(a)})},async updateUsuario(a,b){return this.request(`/api/usuarios/${a}`,{method:"PUT",body:JSON.stringify(b)})},async deleteUsuario(a){return this.request(`/api/usuarios/${a}`,{method:"DELETE"})},async createCategoria(a){return this.request("/api/categorias",{method:"POST",body:JSON.stringify(a)})},async updateCategoria(a,b){return this.request(`/api/categorias/${a}`,{method:"PUT",body:JSON.stringify(b)})},async deleteCategoria(a){return this.request(`/api/categorias/${a}`,{method:"DELETE"})},async reorderCategorias(a){return this.request("/api/categorias/reorder",{method:"POST",body:JSON.stringify({ordens:a})})},async getEstatisticasAdmin(){return this.request("/api/admin/estatisticas")},async limparNomesUsuarios(){return this.request("/api/admin/manutencao/limpar-nomes",{method:"POST"})},async configurarSuperAdmin(a){return this.request("/api/admin/manutencao/super-admin",{method:"POST",body:JSON.stringify(a)})},async getRepertorioAtivo(){return this.request("/api/repertorio/ativo")},async getRepertorio(a){return this.request(`/api/repertorio/${a}`)},async getRepertorioInstrumentos(a){return this.request(`/api/repertorio/${a}/instrumentos`)},async getRepertorios(){return this.request("/api/repertorios")},async createRepertorio(a){return this.request("/api/repertorios",{method:"POST",body:JSON.stringify(a)})},async updateRepertorio(a,b){return this.request(`/api/repertorio/${a}`,{method:"PUT",body:JSON.stringify(b)})},async deleteRepertorio(a){return this.request(`/api/repertorio/${a}`,{method:"DELETE"})},async addPartituraToRepertorio(a,b){return this.request(`/api/repertorio/${a}/partituras`,{method:"POST",body:JSON.stringify({partitura_id:b})})},async removePartituraFromRepertorio(a,b){return this.request(`/api/repertorio/${a}/partituras/${b}`,{method:"DELETE"})},async reorderRepertorioPartituras(a,b){return this.request(`/api/repertorio/${a}/reorder`,{method:"PUT",body:JSON.stringify({ordens:b})})},async duplicarRepertorio(a){return this.request(`/api/repertorio/${a}/duplicar`,{method:"POST"})},async isPartituraInRepertorio(a){return this.request(`/api/partituras/${a}/in-repertorio`)},getRepertorioDownloadUrl(a,b,d="pdf",e=null){let f=`${c}/api/repertorio/${a}/download?formato=${d}`;return b&&(f+=`&instrumento=${encodeURIComponent(b)}`),e&&e.length>0&&(f+=`&partituras=${e.join(",")}`),f},async getModoRecesso(){try{let a=await fetch(`${c}/api/config/recesso`);if(!a.ok)return{ativo:!1};return await a.json()}catch{return{ativo:!1}}},async setModoRecesso(a){return this.request("/api/config/recesso",{method:"PUT",body:JSON.stringify({ativo:a})})},async getMinhaPresenca(){return this.request("/api/presenca/minhas")},async registrarPresencas(a,b){return this.request("/api/presenca",{method:"POST",body:JSON.stringify({data_ensaio:a,usuarios_ids:b})})},async getTodasPresencas(){return this.request("/api/presenca/todas")},async getPartiturasEnsaio(a){return this.request(`/api/ensaios/${a}/partituras`)},async addPartituraEnsaio(a,b){return this.request(`/api/ensaios/${a}/partituras`,{method:"POST",body:JSON.stringify({partitura_id:b})})},async removePartituraEnsaio(a,b){return this.request(`/api/ensaios/${a}/partituras/${b}`,{method:"DELETE"})},async reorderPartiturasEnsaio(a,b){return this.request(`/api/ensaios/${a}/partituras/reorder`,{method:"PUT",body:JSON.stringify({ordens:b})})}},"USE_API",0,!0],40811)},15771,a=>{"use strict";var b=a.i(42485),c=a.i(66592),d=a.i(63840);let e=(0,c.createContext)(null);a.s(["UIProvider",0,({children:a})=>{let[f,g]=(0,c.useState)(()=>d.default.get("themeMode","system")),h=(0,c.useCallback)(()=>"light",[f]),[i,j]=(0,c.useState)(h),[k,l]=(0,c.useState)(null),m=(0,c.useCallback)((a,b="success")=>l({message:a,type:b}),[]),n=(0,c.useCallback)(()=>l(null),[]),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!1),y=(0,c.useCallback)(a=>{v(b=>b.some(b=>b.parteId===a.parteId)?b:[...b,a])},[]),z=(0,c.useCallback)(a=>{v(b=>b.filter(b=>b.parteId!==a))},[]),A=(0,c.useCallback)(()=>{v([])},[]);return(0,c.useEffect)(()=>{},[f]),(0,c.useEffect)(()=>{"u">typeof document&&document.documentElement.setAttribute("data-theme",i)},[i]),(0,c.useEffect)(()=>{d.default.set("themeMode",f)},[f]),(0,b.jsx)(e.Provider,{value:{theme:i,themeMode:f,setThemeMode:g,toast:k,showToast:m,clearToast:n,sidebarCollapsed:o,setSidebarCollapsed:p,selectedSheet:q,setSelectedSheet:r,showNotifications:s,setShowNotifications:t,shareCart:u,showShareCart:w,setShowShareCart:x,addToShareCart:y,removeFromShareCart:z,clearShareCart:A},children:a})},"useUI",0,()=>{let a=(0,c.useContext)(e);if(!a)throw Error("useUI must be used within UIProvider");return a}])},67963,a=>{"use strict";var b=a.i(42485),c=a.i(66592),d=a.i(63840),e=a.i(40811);let f=(0,c.createContext)(null);a.s(["AuthProvider",0,({children:a,onTokenExpired:g})=>{let[h,i]=(0,c.useState)(()=>d.default.get("user",null)),j=(0,c.useCallback)(()=>{e.API.logout(),i(null),d.default.remove("user"),d.default.remove("favorites"),d.default.remove("authToken")},[]);return(0,c.useEffect)(()=>(e.API.setOnTokenExpired(()=>{j(),g&&g()}),()=>{e.API.setOnTokenExpired(null)}),[j,g]),(0,c.useEffect)(()=>{e.USE_API&&e.API.isTokenExpired()&&j()},[j]),(0,c.useEffect)(()=>{d.default.set("user",h)},[h]),(0,b.jsx)(f.Provider,{value:{user:h,setUser:i,logout:j},children:a})},"useAuth",0,()=>{let a=(0,c.useContext)(f);if(!a)throw Error("useAuth must be used within AuthProvider");return a}])}];

//# sourceMappingURL=frontend-next_src_f30ad70f._.js.map