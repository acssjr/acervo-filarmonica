(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8597,e=>{"use strict";let t;var r=e.i(89123),a=e.i(65590),i=e.i(47621),o=e.i(7690);let s=[{id:"dobrados",name:"Dobrados"},{id:"marchas",name:"Marchas"},{id:"marchas-funebres",name:"Marchas Fúnebres"},{id:"marchas-religiosas",name:"Marchas Religiosas"},{id:"fantasias",name:"Fantasias"},{id:"polacas",name:"Polacas"},{id:"boleros",name:"Boleros"},{id:"valsas",name:"Valsas"},{id:"arranjos",name:"Arranjos"},{id:"hinos",name:"Hinos"},{id:"hinos-civicos",name:"Hinos Cívicos"},{id:"hinos-religiosos",name:"Hinos Religiosos"},{id:"preludios",name:"Prelúdios"}];s.map(e=>[e.id,e]);let n=[{id:1,nome:"Grade"},{id:2,nome:"Flautim"},{id:3,nome:"Flauta"},{id:4,nome:"Requinta"},{id:5,nome:"Clarinete Bb"},{id:6,nome:"Clarinete Bb 1"},{id:7,nome:"Clarinete Bb 2"},{id:8,nome:"Sax. Soprano"},{id:9,nome:"Sax. Alto"},{id:10,nome:"Sax. Alto 1"},{id:11,nome:"Sax. Alto 2"},{id:12,nome:"Sax. Tenor"},{id:13,nome:"Sax. Tenor 1"},{id:14,nome:"Sax. Tenor 2"},{id:15,nome:"Sax. Barítono"},{id:16,nome:"Trompete Bb"},{id:17,nome:"Trompete Bb 1"},{id:18,nome:"Trompete Bb 2"},{id:19,nome:"Trompa F"},{id:20,nome:"Trompa Eb"},{id:21,nome:"Trompa Eb 1"},{id:22,nome:"Trompa Eb 2"},{id:23,nome:"Barítono Bb"},{id:24,nome:"Barítono Bb 1"},{id:25,nome:"Barítono Bb 2"},{id:26,nome:"Trombone"},{id:27,nome:"Trombone 1"},{id:28,nome:"Trombone 2"},{id:29,nome:"Bombardino"},{id:30,nome:"Bombardino Bb"},{id:31,nome:"Baixo Eb"},{id:32,nome:"Baixo Bb"},{id:33,nome:"Caixa"},{id:34,nome:"Bombo"},{id:35,nome:"Pratos"}];n.map(e=>e.nome),t=new Map,n.forEach(e=>{t.set(e.nome.toLowerCase(),e)});let u=(0,a.createContext)(null);e.s(["DataProvider",0,({children:e})=>{let[t,d]=(0,a.useState)(()=>i.default.get("sheets",[{id:"1",title:"Verde e Branco",composer:"Estevam Moura",category:"dobrados",year:1940,downloads:567,featured:!0},{id:"2",title:"Magnata",composer:"Estevam Moura",category:"dobrados",year:1945,downloads:489,featured:!0},{id:"3",title:"Tusca",composer:"Estevam Moura",category:"dobrados",year:1942,downloads:423,featured:!1},{id:"4",title:"Dois Corações",composer:"Pedro Salgado",category:"dobrados",year:1935,downloads:512,featured:!0},{id:"5",title:"Os Corujas",composer:"Heraclio Guerreiro",category:"dobrados",year:1920,downloads:298,featured:!0}])),[l,c]=(0,a.useState)(!0),[h,p]=(0,a.useState)(!1),[m,f]=(0,a.useState)(()=>i.default.get("categories",null)||s),[y,g]=(0,a.useState)(()=>i.default.get("instruments",null)||n),[P,E]=(0,a.useState)(()=>i.default.get("favorites",[])),[S,v]=(0,a.useState)("home"),[b,T]=(0,a.useState)(null),[w,$]=(0,a.useState)(null),[q,A]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{if(!o.USE_API)return c(!1);try{let e=await o.API.healthCheck();if(p(e),e){let[e,t,r]=await Promise.all([o.API.getPartituras(),o.API.getCategorias(),o.API.getInstrumentos()]);if(e&&e.length>0){let t=e.map(e=>({id:String(e.id),title:e.titulo,composer:e.compositor,category:e.categoria_id,year:e.ano,downloads:e.downloads||0,featured:1===e.destaque,hasFile:!!e.arquivo_nome,apiId:e.id}));d(t),i.default.set("sheets",t)}if(t&&t.length>0){let e=t.map(e=>({id:e.id,name:e.nome}));f(e),i.default.set("categories",e)}if(r&&r.length>0){let e=r.map(e=>({id:e.id,nome:e.nome}));g(e),i.default.set("instruments",e)}}}catch(e){console.error("Erro ao carregar da API:",e)}finally{c(!1)}})()},[]),(0,a.useEffect)(()=>{i.default.set("sheets",t)},[t]),(0,a.useEffect)(()=>{i.default.set("favorites",P)},[P]),(0,a.useEffect)(()=>{i.default.set("categories",m)},[m]),(0,a.useEffect)(()=>{i.default.set("instruments",y)},[y]);let k=(0,a.useMemo)(()=>new Map(m.map(e=>[e.id,e])),[m]),I=(0,a.useMemo)(()=>y.map(e=>e.nome),[y]),C=(0,a.useCallback)(async()=>{let e=i.default.get("authToken",null);if(o.USE_API&&e)try{let e=await o.API.getFavoritosIds();if(e&&Array.isArray(e)){let t=e.map(e=>String(e));E(t),i.default.set("favorites",t)}}catch{}},[]),O=(0,a.useCallback)(e=>{let t=i.default.get("authToken",null);E(r=>{let a=r.includes(e),i=a?r.filter(t=>t!==e):[...r,e];return o.USE_API&&t&&(a?o.API.removeFavorito(e):o.API.addFavorito(e)).catch(()=>{E(t=>!a===t.includes(e)?a?[...t,e]:t.filter(t=>t!==e):t)}),i})},[]),x=(0,a.useCallback)(e=>{d(t=>[...t,e])},[]);return(0,r.jsx)(u.Provider,{value:{sheets:t,setSheets:d,addSheet:x,favorites:P,setFavorites:E,toggleFavorite:O,loadUserFavorites:C,categories:m,categoriesMap:k,instruments:y,instrumentNames:I,activeTab:S,setActiveTab:v,selectedCategory:b,setSelectedCategory:T,selectedComposer:w,setSelectedComposer:$,searchQuery:q,setSearchQuery:A,isLoading:l,apiOnline:h},children:e})},"useData",0,()=>{let e=(0,a.useContext)(u);if(!e)throw Error("useData must be used within DataProvider");return e}],8597)},47621,85365,7690,e=>{"use strict";let t="fil_",r={get(e,r){try{let a=localStorage.getItem(`${t}${e}`);return a?JSON.parse(a):r}catch{return r}},set(e,r){try{localStorage.setItem(`${t}${e}`,JSON.stringify(r))}catch{}},remove(e){try{localStorage.removeItem(`${t}${e}`)}catch{}},clear(e){try{localStorage.removeItem(`${t}${e}`)}catch{}}};e.s(["Storage",0,r,"default",0,r],47621);var a=e.i(11274);let i="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"":a.default.env.NEXT_PUBLIC_API_URL||"https://acervo-filarmonica-api.acssjr.workers.dev";e.s(["API_BASE_URL",0,i,"TOKEN_EXPIRY_BUFFER_MS",0,3e5],85365);let o=null;e.s(["API",0,{setOnTokenExpired(e){o=e},isTokenExpired(){let e=r.get("authToken",null),t=r.get("tokenExpiresAt",null);return!!e&&(!t||Date.now()>t-3e5)},clearAuth(){r.remove("authToken"),r.remove("tokenExpiresAt"),r.remove("user")},async request(e,t={}){try{if(this.isTokenExpired())throw this.clearAuth(),o&&o(),Error("Sessão expirada. Faça login novamente.");let a=r.get("authToken",null),s={"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`},...t.headers},n=await fetch(`${i}${e}`,{...t,headers:s});if(401===n.status){let e=await n.json().catch(()=>({error:"Não autorizado"}));throw this.clearAuth(),o&&o(),Error(e.error||"Sessão expirada. Faça login novamente.")}if(!n.ok){let e=await n.json().catch(()=>({error:"Erro desconhecido"}));throw Error(e.error||`HTTP ${n.status}`)}return await n.json()}catch(t){throw console.error(`API Error [${e}]:`,t),t}},async getPartituras(e={}){let t=new URLSearchParams;e.categoria&&t.append("categoria",e.categoria),e.busca&&t.append("busca",e.busca),e.destaque&&t.append("destaque","1");let r=t.toString();return this.request(`/api/partituras${r?`?${r}`:""}`)},async getPartitura(e){return this.request(`/api/partituras/${e}`)},async createPartitura(e){let t=r.get("authToken",null),a=await fetch(`${i}/api/partituras`,{method:"POST",headers:{...t&&{Authorization:`Bearer ${t}`}},body:e});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Erro no upload"}))).error);return a.json()},async updatePartitura(e,t){return this.request(`/api/partituras/${e}`,{method:"PUT",body:JSON.stringify(t)})},async deletePartitura(e){return this.request(`/api/partituras/${e}`,{method:"DELETE"})},async uploadPastaPartitura(e){let t=r.get("authToken",null),a=await fetch(`${i}/api/partituras/upload-pasta`,{method:"POST",headers:{...t&&{Authorization:`Bearer ${t}`}},body:e});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Erro no upload"}))).error);return a.json()},async getPartesPartitura(e){return this.request(`/api/partituras/${e}/partes`)},async addPartePartitura(e,t){let a=r.get("authToken",null),o=await fetch(`${i}/api/partituras/${e}/partes`,{method:"POST",headers:{...a&&{Authorization:`Bearer ${a}`}},body:t});if(!o.ok)throw Error((await o.json().catch(()=>({error:"Erro ao adicionar parte"}))).error);return o.json()},async replacePartePartitura(e,t,a){let o=r.get("authToken",null),s=await fetch(`${i}/api/partes/${t}/substituir`,{method:"PUT",headers:{...o&&{Authorization:`Bearer ${o}`}},body:a});if(!s.ok)throw Error((await s.json().catch(()=>({error:"Erro ao substituir parte"}))).error);return s.json()},async deletePartePartitura(e,t){return this.request(`/api/partes/${t}`,{method:"DELETE"})},getDownloadUrl(e,t=null){let r=`${i}/api/download/${e}`;return t&&(r+=`?instrumento=${t}`),r},async getCategorias(){return this.request("/api/categorias")},async getInstrumentos(){return this.request("/api/instrumentos")},async getEstatisticas(){return this.request("/api/estatisticas")},async getAtividades(){return this.request("/api/atividades")},async getMinhasAtividades(){return this.request("/api/minhas-atividades")},async login(e,t,a=!1){let i=await this.request("/api/login",{method:"POST",body:JSON.stringify({username:e,pin:t,rememberMe:a})});if(i.token&&(r.set("authToken",i.token),i.expiresIn)){let e=Date.now()+1e3*i.expiresIn;r.set("tokenExpiresAt",e)}return i},async changePin(e,t){try{let a=await this.request("/api/change-pin",{method:"POST",body:JSON.stringify({currentPin:e,newPin:t})});if(a.token){r.set("authToken",a.token);let e=Date.now()+864e5;r.set("tokenExpiresAt",e)}return a}catch(e){return{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}},logout(){this.clearAuth()},async healthCheck(){try{let e=await this.request("/api/health");return"ok"===e.status}catch{return!1}},async getVersion(){try{return await this.request("/api/version")}catch{return null}},async getPerfil(){return this.request("/api/perfil")},async updatePerfil(e){return this.request("/api/perfil",{method:"PUT",body:JSON.stringify(e)})},async uploadFotoPerfil(e){let t=r.get("authToken",null),a=new FormData;a.append("foto",e);let o=await fetch(`${i}/api/perfil/foto`,{method:"POST",headers:{...t&&{Authorization:`Bearer ${t}`}},body:a});if(!o.ok)throw Error((await o.json().catch(()=>({error:"Erro no upload"}))).error);return o.json()},async getFavoritos(){return this.request("/api/favoritos")},async getFavoritosIds(){return this.request("/api/favoritos/ids")},async addFavorito(e){return this.request(`/api/favoritos/${e}`,{method:"POST"})},async removeFavorito(e){return this.request(`/api/favoritos/${e}`,{method:"DELETE"})},async getUsuarios(){return this.request("/api/usuarios")},async getUsuario(e){return this.request(`/api/usuarios/${e}`)},async createUsuario(e){return this.request("/api/usuarios",{method:"POST",body:JSON.stringify(e)})},async updateUsuario(e,t){return this.request(`/api/usuarios/${e}`,{method:"PUT",body:JSON.stringify(t)})},async deleteUsuario(e){return this.request(`/api/usuarios/${e}`,{method:"DELETE"})},async createCategoria(e){return this.request("/api/categorias",{method:"POST",body:JSON.stringify(e)})},async updateCategoria(e,t){return this.request(`/api/categorias/${e}`,{method:"PUT",body:JSON.stringify(t)})},async deleteCategoria(e){return this.request(`/api/categorias/${e}`,{method:"DELETE"})},async reorderCategorias(e){return this.request("/api/categorias/reorder",{method:"POST",body:JSON.stringify({ordens:e})})},async getEstatisticasAdmin(){return this.request("/api/admin/estatisticas")},async limparNomesUsuarios(){return this.request("/api/admin/manutencao/limpar-nomes",{method:"POST"})},async configurarSuperAdmin(e){return this.request("/api/admin/manutencao/super-admin",{method:"POST",body:JSON.stringify(e)})},async getRepertorioAtivo(){return this.request("/api/repertorio/ativo")},async getRepertorio(e){return this.request(`/api/repertorio/${e}`)},async getRepertorioInstrumentos(e){return this.request(`/api/repertorio/${e}/instrumentos`)},async getRepertorios(){return this.request("/api/repertorios")},async createRepertorio(e){return this.request("/api/repertorios",{method:"POST",body:JSON.stringify(e)})},async updateRepertorio(e,t){return this.request(`/api/repertorio/${e}`,{method:"PUT",body:JSON.stringify(t)})},async deleteRepertorio(e){return this.request(`/api/repertorio/${e}`,{method:"DELETE"})},async addPartituraToRepertorio(e,t){return this.request(`/api/repertorio/${e}/partituras`,{method:"POST",body:JSON.stringify({partitura_id:t})})},async removePartituraFromRepertorio(e,t){return this.request(`/api/repertorio/${e}/partituras/${t}`,{method:"DELETE"})},async reorderRepertorioPartituras(e,t){return this.request(`/api/repertorio/${e}/reorder`,{method:"PUT",body:JSON.stringify({ordens:t})})},async duplicarRepertorio(e){return this.request(`/api/repertorio/${e}/duplicar`,{method:"POST"})},async isPartituraInRepertorio(e){return this.request(`/api/partituras/${e}/in-repertorio`)},getRepertorioDownloadUrl(e,t,r="pdf",a=null){let o=`${i}/api/repertorio/${e}/download?formato=${r}`;return t&&(o+=`&instrumento=${encodeURIComponent(t)}`),a&&a.length>0&&(o+=`&partituras=${a.join(",")}`),o},async getModoRecesso(){try{let e=await fetch(`${i}/api/config/recesso`);if(!e.ok)return{ativo:!1};return await e.json()}catch{return{ativo:!1}}},async setModoRecesso(e){return this.request("/api/config/recesso",{method:"PUT",body:JSON.stringify({ativo:e})})},async getMinhaPresenca(){return this.request("/api/presenca/minhas")},async registrarPresencas(e,t){return this.request("/api/presenca",{method:"POST",body:JSON.stringify({data_ensaio:e,usuarios_ids:t})})},async getTodasPresencas(){return this.request("/api/presenca/todas")},async getPartiturasEnsaio(e){return this.request(`/api/ensaios/${e}/partituras`)},async addPartituraEnsaio(e,t){return this.request(`/api/ensaios/${e}/partituras`,{method:"POST",body:JSON.stringify({partitura_id:t})})},async removePartituraEnsaio(e,t){return this.request(`/api/ensaios/${e}/partituras/${t}`,{method:"DELETE"})},async reorderPartiturasEnsaio(e,t){return this.request(`/api/ensaios/${e}/partituras/reorder`,{method:"PUT",body:JSON.stringify({ordens:t})})}},"USE_API",0,!0],7690)},40915,e=>{"use strict";var t=e.i(89123),r=e.i(65590),a=e.i(47621);let i=(0,r.createContext)(null);e.s(["UIProvider",0,({children:e})=>{let[o,s]=(0,r.useState)(()=>a.default.get("themeMode","system")),n=(0,r.useCallback)(()=>"system"===o?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":o,[o]),[u,d]=(0,r.useState)(n),[l,c]=(0,r.useState)(null),h=(0,r.useCallback)((e,t="success")=>c({message:e,type:t}),[]),p=(0,r.useCallback)(()=>c(null),[]),[m,f]=(0,r.useState)(!1),[y,g]=(0,r.useState)(null),[P,E]=(0,r.useState)(!1),[S,v]=(0,r.useState)([]),[b,T]=(0,r.useState)(!1),w=(0,r.useCallback)(e=>{v(t=>t.some(t=>t.parteId===e.parteId)?t:[...t,e])},[]),$=(0,r.useCallback)(e=>{v(t=>t.filter(t=>t.parteId!==e))},[]),q=(0,r.useCallback)(()=>{v([])},[]);return(0,r.useEffect)(()=>{let e=()=>{d("system"===o?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":o)};e();{let t=window.matchMedia("(prefers-color-scheme: dark)");return t.addEventListener("change",e),()=>t.removeEventListener("change",e)}},[o]),(0,r.useEffect)(()=>{"u">typeof document&&document.documentElement.setAttribute("data-theme",u)},[u]),(0,r.useEffect)(()=>{a.default.set("themeMode",o)},[o]),(0,t.jsx)(i.Provider,{value:{theme:u,themeMode:o,setThemeMode:s,toast:l,showToast:h,clearToast:p,sidebarCollapsed:m,setSidebarCollapsed:f,selectedSheet:y,setSelectedSheet:g,showNotifications:P,setShowNotifications:E,shareCart:S,showShareCart:b,setShowShareCart:T,addToShareCart:w,removeFromShareCart:$,clearShareCart:q},children:e})},"useUI",0,()=>{let e=(0,r.useContext)(i);if(!e)throw Error("useUI must be used within UIProvider");return e}])},3249,e=>{"use strict";var t=e.i(89123),r=e.i(65590),a=e.i(47621),i=e.i(7690);let o=(0,r.createContext)(null);e.s(["AuthProvider",0,({children:e,onTokenExpired:s})=>{let[n,u]=(0,r.useState)(()=>a.default.get("user",null)),d=(0,r.useCallback)(()=>{i.API.logout(),u(null),a.default.remove("user"),a.default.remove("favorites"),a.default.remove("authToken")},[]);return(0,r.useEffect)(()=>(i.API.setOnTokenExpired(()=>{d(),s&&s()}),()=>{i.API.setOnTokenExpired(null)}),[d,s]),(0,r.useEffect)(()=>{i.USE_API&&i.API.isTokenExpired()&&d()},[d]),(0,r.useEffect)(()=>{a.default.set("user",n)},[n]),(0,t.jsx)(o.Provider,{value:{user:n,setUser:u,logout:d},children:e})},"useAuth",0,()=>{let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}])},63806,e=>{"use strict";var t=e.i(89123),r=e.i(65590),a=e.i(47621),i=e.i(7690);let o=(0,r.createContext)(null),s=e=>({id:`activity-${e.id}`,type:"nova_partitura",title:e.titulo,composer:e.detalhes,date:e.criado_em,read:a.default.get(`notification-read-${e.id}`,!1)});e.s(["NotificationProvider",0,({children:e})=>{let[n,u]=(0,r.useState)([]),[d,l]=(0,r.useState)(!0),c=(0,r.useCallback)(async()=>{try{l(!0);let e=await i.API.getAtividades();if(e&&Array.isArray(e)){let t=e.filter(e=>"nova_partitura"===e.tipo).slice(0,30).map(s);u(t)}}catch{u([])}finally{l(!1)}},[]);(0,r.useEffect)(()=>{c()},[c]);let h=(0,r.useCallback)(e=>{u(t=>t.map(t=>{if(t.id===e){let r=e.replace("activity-","");return a.default.set(`notification-read-${r}`,!0),{...t,read:!0}}return t}))},[]),p=(0,r.useCallback)(()=>{u(e=>e.map(e=>{let t=e.id.replace("activity-","");return a.default.set(`notification-read-${t}`,!0),{...e,read:!0}}))},[]),m=(0,r.useCallback)(()=>{u([])},[]),f=(0,r.useCallback)(()=>{c()},[c]),y=(0,r.useMemo)(()=>n.filter(e=>!e.read).length,[n]);return(0,t.jsx)(o.Provider,{value:{notifications:n,loading:d,markNotificationAsRead:h,markAllNotificationsAsRead:p,clearNotifications:m,refreshNotifications:f,unreadCount:y},children:e})},"useNotifications",0,()=>{let e=(0,r.useContext)(o);if(!e)throw Error("useNotifications must be used within NotificationProvider");return e}])},62342,e=>{"use strict";var t=e.i(89123),r=e.i(3249),a=e.i(8597),i=e.i(40915),o=e.i(63806);function s({children:e}){return(0,t.jsx)(r.AuthProvider,{children:(0,t.jsx)(a.DataProvider,{children:(0,t.jsx)(i.UIProvider,{children:(0,t.jsx)(o.NotificationProvider,{children:e})})})})}e.s(["default",()=>s])}]);